package cert

import (
	"testing"

	"github.com/kubernetes-sigs/aws-alb-ingress-controller/internal/ingress/tls"
	"github.com/magiconair/properties/assert"
)

func TestBuildCertHash(t *testing.T) {
	for _, tc := range []struct {
		cert         tls.RawCertificate
		expectedHash string
	}{
		{
			cert: tls.RawCertificate{
				Certificate: []byte(`-----BEGIN CERTIFICATE-----
MIICqDCCAZACAQEwDQYJKoZIhvcNAQELBQAwHjEcMBoGA1UEAwwTU21hbGxGMXNo
IEF1dGhvcml0eTAeFw0xOTAxMjIyMzQwMzhaFw0yMDAxMjIyMzQwMzhaMBYxFDAS
BgNVBAMMC2V4YW1wbGUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC
AQEAsjzs7uQsa6r5RhbraDBIEHedIQcYCWl8HbRP1H8153ejJp9gfiUrCCY1VlWv
Fls90MBBgDa9yJ9hzvDEC3Eph0YqVP0xSkO/s7lQY5UDOxim1/RRyT2pEQECUImE
8c6Zu/qLh84I3rXXpAqTOzaMqTgNwYTEf0p4z3+YMBhwQv+5ASAR3Awit6lpg2pA
NZbToET61LxsFPABZCERFNMkzew5AnpgU4pwDvT7+704i+ncSQcOHzoA8iNBvaEd
sHR8z5+aBl6bTym9dkziqWRQPr7YfICeU3UbTsK46GG1QoeZUeetnJn9v3ULC/Y3
3/YpUvvcJYxbbH48Ti0Gue0gDwIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQBBcAm9
5WQlmQHLG8Ju0c9YAIEag8xJi/02jJhFGo2DWbZ0OHk8VtX46YeFmrwwkEcgKevq
bPQafr3RJLC6zqQe+wYRkuwueFcs5gLlc0rGp9aIeBDnGegUBL4CON/yLgmQqhn9
WuwycHa1a1LYzVptmGhgYlyqPmvq/rAVdXU5DGAemwEHyKltKzoIMRGm3v2BPIWq
SNjbTdWb5eQjCVaBDTVP1SBbRBGQKB1AunjQbvJ1UgU0IyQxd+jXN0rKjQnu54IK
De/JpJWCe4IlNbNAjzZTEQR1Z5Hr3Ts9s9C0VMjvFGJP7r3JTyTQX6AV7mmZYUXU
fvSSEQsaHm/snS1G
-----END CERTIFICATE-----`),
				CertificateChain: []byte(`-----BEGIN CERTIFICATE-----
MIICrzCCAZcCAQEwDQYJKoZIhvcNAQELBQAwHTEbMBkGA1UEAwwSTTAwbkYxc2gg
QXV0aG9yaXR5MB4XDTE5MDEyMjIzNDAyNVoXDTIwMDEyMjIzNDAyNVowHjEcMBoG
A1UEAwwTU21hbGxGMXNoIEF1dGhvcml0eTCCASIwDQYJKoZIhvcNAQEBBQADggEP
ADCCAQoCggEBANmwBHXTZwyYqdHReuuJ6yR9y7uYAYACyAQo49+MjLFTsK0l7Xxj
FEtZrswHJxJF5ZRRrQevaIjZF22PZTb2E7Aqzg/3CQyBfycvYJPcdjcK9nCxVxnS
36PbJ0c0b0OipPEvKIKVbqdjjTtCxB8vG+yn9rvcgqiMMlxGA7ZA5kh8OBNSwBCR
e7p1o3AezGOvjBJJ6rfmWh9K921XJQnD66KCG/g07lfQMUaDUXUifQVSiu6n6Tr7
FxkNx2blYwZTlyzAaneM87nM2THA2u0xWva3tI+r2Pjx/r3d9VT5ec8/3wA6fVwH
CbmfuSbSfYyC4Vc3unGJn5OmNGUyQXvccvkCAwEAATANBgkqhkiG9w0BAQsFAAOC
AQEAcT16210U07awhrk+wFuVjD5GRtzFPFDdiWmZgdAVt6FDdktUfNOOiiL7F1O4
FSVwuNHeGyO3YK8n/UpOjlPGWaWc77/DTGOcH3jcRoWI3eghDYnMd26DOiRB1oid
bXEm68bVunmaxjMXtYnsFSc/uYvq34z+AFgpE8uMoTvqfazR4MYBjJcFUFH/Umvz
QBerlzJkCfZS7niK1rUDlQrgTKzU720k/IHM1IsO/ANuW39atqElTRYmdNPPxE7k
ZbRnZpHaL8/CI59qNk5UcXpmlSTbFuOGHZnUkSN/8xio8vqT9i98tTRTZsiM98p1
CcIB+6oleRWO9rlmXXlnPH4T9A==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIICtjCCAZ4CCQDEvYsLLtLauDANBgkqhkiG9w0BAQsFADAdMRswGQYDVQQDDBJN
MDBuRjFzaCBBdXRob3JpdHkwHhcNMTkwMTIyMjM0MDA5WhcNMjAwMTIyMjM0MDA5
WjAdMRswGQYDVQQDDBJNMDBuRjFzaCBBdXRob3JpdHkwggEiMA0GCSqGSIb3DQEB
AQUAA4IBDwAwggEKAoIBAQC95nwkCbDLJAFWlxCrC+aTr0C61K6hYMDoU4Wt4rXq
5bYL7NdCAhtdyfQY6wFgMi61nzCf2GLPxObMU9cRXqP/dVjWzegHCJ7fcH1E3W57
MauFhd3tdish6QZCQpYcxD5vkgZ/fZs8RVbVfDt5E7q/qq9myDZJSh+Y4g+fkLUP
P6cUwakAAl2/pWQHdf/7hvxyrVtYf2T7R6qwovJDG6P9sDtSlh1Uojfh+I0dpC3S
mL+qy5FLfArRTPPhjHRMz404w6rvfy9hacgpkSnqeDHDfm9dRF/YBQMQv4mh/HfH
8ulCZyUezCYiaQ9TaZ9WI3NjixUhhsnLAWXwEF39uZPZAgMBAAEwDQYJKoZIhvcN
AQELBQADggEBAD0b9nD4QqZA0UN5aRXA69CtbojMy0jpon1Sc96EWZC4KZTeOG79
ODF+OWVwJ2+ROwkBXLvH7TMQzdW8XEUf9l1fvb7Q+HPCwmA1IsP5emnO/heJpIoz
0HnVojs8/cXPd2ZoQhOgYBMRQwfKgNwQGMUjGDNedzOkpE1ZiURdnLyWfuViWif0
b5G3rSYOHyAs3Rc/4YWy4bILUaLYUj8X0Ng3wBe+XP+vpndcJZDjSJrb7zWf6hzV
k9iz7S0cugYpanMtv4Rh1+pP2Q2nERdKM++2Ld3cMK4tX7bySVkW/fN/gfHmUfHs
dRtjFv7g579jZp8krL+kGHJUd76GSWz8TYI=
-----END CERTIFICATE-----`),
				PrivateKey: []byte(`-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCyPOzu5CxrqvlG
FutoMEgQd50hBxgJaXwdtE/UfzXnd6Mmn2B+JSsIJjVWVa8WWz3QwEGANr3In2HO
8MQLcSmHRipU/TFKQ7+zuVBjlQM7GKbX9FHJPakRAQJQiYTxzpm7+ouHzgjetdek
CpM7NoypOA3BhMR/SnjPf5gwGHBC/7kBIBHcDCK3qWmDakA1ltOgRPrUvGwU8AFk
IREU0yTN7DkCemBTinAO9Pv7vTiL6dxJBw4fOgDyI0G9oR2wdHzPn5oGXptPKb12
TOKpZFA+vth8gJ5TdRtOwrjoYbVCh5lR562cmf2/dQsL9jff9ilS+9wljFtsfjxO
LQa57SAPAgMBAAECggEASaBhP02CC/fUgN923tMS8bp3be1AQKMSYjLZxy3FVphV
DN9JPNKdtAAUiFVcvh9yqYjBhfUW8IjmHlXWpeNZBEg3tGPiuIrD5bnnOzuS2haU
1SBXqImQDTYdfqdQA5MUblJQ0QiLIXR8X4b+yrb94+kDxazSfsKEpTJP644s0X+g
rzDBrRDA1VYz4ofKY7bRwVEgsNUQS0DJwKfgeMYGCrJmy46xr16Z1lgLTb6A2iT2
5tvsn/R5jgMfFjlk6rRlSdfZcCN0daeNPZyHQev4/Lt1pdAzO+hW6oLeQHLfTf2b
Jd4yZeZHotqTQSnVf/xeAPOHe1FiFIoYiBCQ9ztiAQKBgQDYGVqhoDbs7nRhBUI4
NNxy31yRrPj1FSUAX2VVgZMqXSzVfSK+l8Z2YaYrkyN9WqaFSXSG3DNpg4Aa16sT
IADqDtLCfnHk9wReTqC6sycDsf4QlKLYlqUmDSIQcL4dMVtqac9Ed3iT9DNAt445
WeXjWMVbL8e2069JGSqy2Ih3qwKBgQDTJfEn7sxNokGnurek8ZYqXB1Yy96wMAwq
w4Hs5JaIgSjUtnaF6ZtW+4Ml/WMgByWGF5o2NDAb8ppArqgEK7+tZgwN7Graaz9e
Msa9KJeFqLOYYqqy3KCTCRmditfyO95UF/gbCQ7TniYLbdops+PPYiREmiXNZFfn
iVk9ag1FLQKBgG7pzHeqSKag2QC29z7r+r3G4LcwRXNdD+m6DMOvRr52pj1JBd02
/zjhc61nzs5XCaLdib5yJL0iLk0YpoihY3a+dvQ2e/SdyBMzXhGVRBAEejc+Yrqx
zz/Re8teYmWPYLEkb6pfe3bM3sV3sLrE5lYiyOC9jE7NJWlqTl0PADQTAoGBAL5C
3DDtfu8dnCe1mjFo97Un19HhssH0KaKHFRYPTI2oRNCXseks/Sq97AlZb+62Qdu4
fN8G26rzSoeqWf+YJFntMEODmy1BopIREv/0CcUIpPxVPBd7sr2LX6eUKs49oDMK
fihuWwvY39NAo2sci9SdTKz8cb/IAWXDX8R1QYvpAoGANTRLIrCmxM7tWJwh2Aal
ubSWhhDRdqKTuiMfZblo2AXwKnHDzQYyqWd+0SQUKhpa0OESmtlnpBUSFtanWDyz
KEjjESl5P9VRVUrg3murJlQavad4aYPjjwwGE7fiiTzmtbW+l/332xMAI8itfylv
mb+W7DUk0Owo4iwcRSvGHZ4=
-----END PRIVATE KEY-----`),
			},
			expectedHash: "7fce38ca59cb2ec818806522fdc8758cb97f725325a20470438ec4a692df152e",
		},
	} {
		actualHash := buildCertHash(tc.cert)
		assert.Equal(t, actualHash, tc.expectedHash)
	}
}
